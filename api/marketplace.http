### File variables
@MP_TMF_API_HOST = mp-tmf-api.127.0.0.1.nip.io:8080
@DATA_SERVICE_HOST = mp-data-service.127.0.0.1.nip.io:8080
@USER_ACCESS_TOKEN = eyJhbGciOiJSUzI1NiIsImtpZCI6IjdJQ2VpSERuX2ZQdGpFNnE3WUdDSEd1dzVkRm1MNlA5d3JrYlc3RzdVRFkiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOlsiZGF0YS1zZXJ2aWNlIl0sImNsaWVudF9pZCI6ImRpZDprZXk6ekRuYWV3ZzNoMXNEZE1ZR2hwWG1ucnN0WlhGWXJYRUVSTUFtakhieFFjdm9yQU5BZSIsImV4cCI6MTczNjQ0NDQyMCwiaXNzIjoiZGlkOmtleTp6RG5hZXdnM2gxc0RkTVlHaHBYbW5yc3RaWEZZclhFRVJNQW1qSGJ4UWN2b3JBTkFlIiwia2lkIjoiN0lDZWlIRG5fZlB0akU2cTdZR0NIR3V3NWRGbUw2UDl3cmtiVzdHN1VEWSIsInN1YiI6IiIsInZlcmlmaWFibGVDcmVkZW50aWFsIjp7IkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy8yMDE4L2NyZWRlbnRpYWxzL3YxIiwiaHR0cHM6Ly93d3cudzMub3JnL25zL2NyZWRlbnRpYWxzL3YxIl0sImNyZWRlbnRpYWxTdWJqZWN0Ijp7ImVtYWlsIjoidGVzdEB1c2VyLm9yZyIsImZpcnN0TmFtZSI6IlRlc3QiLCJsYXN0TmFtZSI6IlJlYWRlciJ9LCJpZCI6InVybjp1dWlkOjBiNTgxNTBiLWMzOGEtNDZkZC1iOTcxLWEzZDEyZDVhYTMxZSIsImlzc3VhbmNlRGF0ZSI6IjIwMjUtMDEtMDlUMTc6MDc6NTBaIiwiaXNzdWVyIjoiZGlkOmtleTp6RG5hZXlRVHZWRkJlSzJoTTMzcHVMNURUUjcxYzJ4d2FBdEZncUI4emg5MjVwYjJXIiwidHlwZSI6WyJVc2VyQ3JlZGVudGlhbCJdfX0.azcI3XFbRu9n-SOOlgYKZwl4KtxYZ4-pjOpzxoR1RTUZP2m9LZFOO6mT-mrtUtOjfl2DCxJvZGIT7fCLz2FpdfVvizbQZs8qUSnNjbMvgkeARN_1NPhEdLNZ64T9NKgxKJn1b-gbx-4dUSthLrkbMxI1z5x9s_Wk-d67srcnmACT1qCPMKmqhDBwTWEIlyEsXaNXM08OKKzOPIBbgyRCAYItn-OTkV4myN4FixcQokSO1bmWRzAs6gHF_uszSKGwWgVC_2PDH5-cUTRBWC2NzCbymPnAflvnZ_D-bO90sTFHKY0_QsGv8m0PKS-N3HD-zZVENrIRLv2O34X2dAyRMQ
@OPERATOR_ACCESS_TOKEN = eyJhbGciOiJSUzI1NiIsImtpZCI6IjdJQ2VpSERuX2ZQdGpFNnE3WUdDSEd1dzVkRm1MNlA5d3JrYlc3RzdVRFkiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOlsiZGF0YS1zZXJ2aWNlIl0sImNsaWVudF9pZCI6ImRpZDprZXk6ekRuYWV3ZzNoMXNEZE1ZR2hwWG1ucnN0WlhGWXJYRUVSTUFtakhieFFjdm9yQU5BZSIsImV4cCI6MTczNjQ0NDQ3NywiaXNzIjoiZGlkOmtleTp6RG5hZXdnM2gxc0RkTVlHaHBYbW5yc3RaWEZZclhFRVJNQW1qSGJ4UWN2b3JBTkFlIiwia2lkIjoiN0lDZWlIRG5fZlB0akU2cTdZR0NIR3V3NWRGbUw2UDl3cmtiVzdHN1VEWSIsInN1YiI6IiIsInZlcmlmaWFibGVDcmVkZW50aWFsIjp7IkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy8yMDE4L2NyZWRlbnRpYWxzL3YxIiwiaHR0cHM6Ly93d3cudzMub3JnL25zL2NyZWRlbnRpYWxzL3YxIl0sImNyZWRlbnRpYWxTdWJqZWN0Ijp7ImVtYWlsIjoidGVzdEB1c2VyLm9yZyIsImZpcnN0TmFtZSI6IlRlc3QiLCJsYXN0TmFtZSI6IlJlYWRlciIsInJvbGVzIjpbeyJuYW1lcyI6WyJPUEVSQVRPUiJdLCJ0YXJnZXQiOiJkaWQ6a2V5OnpEbmFleVFUdlZGQmVLMmhNMzNwdUw1RFRSNzFjMnh3YUF0RmdxQjh6aDkyNXBiMlcifV19LCJpZCI6InVybjp1dWlkOjM2YmY3ZGI5LTYwYzQtNDFmOS05MWZjLTkyN2Q3MmZiZjViYSIsImlzc3VhbmNlRGF0ZSI6IjIwMjUtMDEtMDlUMTc6MDg6MDFaIiwiaXNzdWVyIjoiZGlkOmtleTp6RG5hZXlRVHZWRkJlSzJoTTMzcHVMNURUUjcxYzJ4d2FBdEZncUI4emg5MjVwYjJXIiwidHlwZSI6WyJPcGVyYXRvckNyZWRlbnRpYWwiXX19.OQDf2HPKQ0iGT06lJl29ZUidgWoBdrl0TdqOGp3wKA_PCOW-UYTZNxKGaKO-iopJYnZgpeaqMrTzt-DGfFzLoc3PKtWmdfo6cgZsqrvQv5qOrOoKOZi27QI8RXENLlj3aK6ewwkj0RJ05yI7vAv7tbjVtG20DhG8B23dCc-pDrDisoI6EjtEsOVgDxX_hbZGN21fY8sz8FmKYOMG219AveJ1k744CFKzJcMrGvC9cR7-6if2XSwXRTzJEhVa2ww8VRFQ0iX4wNLfOPRkZU1QPpx1hSaeqgDdzkujLEuKnYImAyEJe3ZOAtNEFedJAqHRSz2s-4Dnc2K8mWHyNWPBHg

### 01. Register Marketplace at Provider and obtain its ID
# Generate an access token: 
# ./get_access_token_oid4vp.sh http://mp-data-service.127.0.0.1.nip.io:8080 $USER_CREDENTIAL user ../wallet-identity
@01_CONSUMER-DID = did:key:zDnaeyQTvVFBeK2hM33puL5DTR71c2xwaAtFgqB8zh925pb2W
@01_CONSUMER-NAME = Fancy Marketplace Inc.

POST http://{{MP_TMF_API_HOST}}/tmf-api/party/v4/organization
Accept: */*
Content-Type: application/json
Authorization: Bearer {{USER_ACCESS_TOKEN}}

{
    "name": "{{01_CONSUMER-NAME}}",
    "partyCharacteristic": [
        {
            "name": "did",
            "value": "{{01_CONSUMER-DID}}"
        }
    ]
}

# Marketplace ID: urn:ngsi-ld:organization:99d0f62e-70d6-4a6d-ae9c-fab86e045f3e

## Buy access

### 02. List the offerings
# Generate an access token: 
# ./get_access_token_oid4vp.sh http://mp-data-service.127.0.0.1.nip.io:8080 $USER_CREDENTIAL user ../wallet-identity

GET http://{{MP_TMF_API_HOST}}/tmf-api/productCatalogManagement/v4/productOffering
Authorization: Bearer {{USER_ACCESS_TOKEN}}

#Choose an offering and extract its ID to accept it


### 03. Choose an order
# Generate an access token: 
# ./get_access_token_oid4vp.sh http://mp-data-service.127.0.0.1.nip.io:8080 $USER_CREDENTIAL user ../wallet-identity
@03_ORDER-ID = random-order-id
@03_OFFER-ID = urn:ngsi-ld:product-offering:90c9044b-84f5-4c03-b2d4-1ee3f541cee2
@03_MARKETPLACE-ID = urn:ngsi-ld:organization:800066a4-7a84-490b-9612-8a8d0a0a6d47

POST http://{{MP_TMF_API_HOST}}/tmf-api/productOrderingManagement/v4/productOrder
Accept: */*
Content-Type: application/json
Authorization: Bearer {{USER_ACCESS_TOKEN}}

{
"productOrderItem": [
    {
        "id": "{{03_ORDER-ID}}",
        "action": "add",
        "productOffering": {
            "id":  "{{03_OFFER-ID}}"
        }
    }
    ],
    "relatedParty": [
        {
            "id": "{{03_MARKETPLACE-ID}}"
        }
    ]
}

# Once the order is created, TMForum will notify the ContractManagement to create an entry in the TrustedIssuersList, allowing Fancy Marketplace to access M&P Operation's services with an Operator Credential


### 04. Create an entity as a Marketplace Operator
# Generate an operator access token:
# ./get_access_token_oid4vp.sh http://mp-data-service.127.0.0.1.nip.io:8080 $OPERATOR_CREDENTIAL operator ../wallet-identity

POST http://{{DATA_SERVICE_HOST}}/ngsi-ld/v1/entities
Accept: */*
Content-Type: application/json
Authorization: Bearer {{OPERATOR_ACCESS_TOKEN}}

{
    "id": "urn:ngsi-ld:K8SCluster:fancy-marketplace",
    "type": "K8SCluster",
    "name": {
        "type": "Property",
        "value": "Fancy Marketplace Cluster"
    },
    "numNodes": {
        "type": "Property",
        "value": "3"
    },
    "k8sVersion": {
        "type": "Property",
        "value": "1.26.0"
    }
}


### 05. Get the created entity
@05_ENTITY-ID = urn:ngsi-ld:K8SCluster:fancy-marketplace

GET http://{{DATA_SERVICE_HOST}}/ngsi-ld/v1/entities/{{05_ENTITY-ID}}
Accept: */*
Authorization: Bearer {{OPERATOR_ACCESS_TOKEN}}