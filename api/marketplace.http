### File variables
@ML_TMF_API_HOST = ml-tmf-api.127.0.0.1.nip.io:8080
@DATA_SERVICE_HOST = ml-data-service.127.0.0.1.nip.io:8080
@USER_ACCESS_TOKEN = eyJhbGciOiJSUzI1NiIsImtpZCI6IkphZjNTMXkxTzBjNnZXUkZ4Z1FGek5fMjdMSjhzdnotUHNKTkp0dUVjb0EiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOlsiZGF0YS1zZXJ2aWNlIl0sImNsaWVudF9pZCI6ImRpZDprZXk6ekRuYWVuWVh4aThvanlEVG1hN1hCTGFtNTR2ZVJMTXkyZXNzZEp0TFdaZ1pzZnE5SyIsImV4cCI6MTc1MTU3MjAxMSwiaXNzIjoiZGlkOmtleTp6RG5hZW5ZWHhpOG9qeURUbWE3WEJMYW01NHZlUkxNeTJlc3NkSnRMV1pnWnNmcTlLIiwia2lkIjoiSmFmM1MxeTFPMGM2dldSRnhnUUZ6Tl8yN0xKOHN2ei1Qc0pOSnR1RWNvQSIsInN1YiI6IiIsInZlcmlmaWFibGVDcmVkZW50aWFsIjp7IkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy8yMDE4L2NyZWRlbnRpYWxzL3YxIiwiaHR0cHM6Ly93d3cudzMub3JnL25zL2NyZWRlbnRpYWxzL3YxIl0sImNyZWRlbnRpYWxTdWJqZWN0Ijp7ImVtYWlsIjoidGVzdEB1c2VyLm9yZyIsImZpcnN0TmFtZSI6IlRlc3QiLCJsYXN0TmFtZSI6IlJlYWRlciJ9LCJpZCI6InVybjp1dWlkOjNiOGM0OWRlLTNmNGMtNGZlYS1hOTY2LWQ3M2E1MjdhNTk3NiIsImlzc3VhbmNlRGF0ZSI6IjIwMjUtMDctMDNUMTg6Mzg6MDVaIiwiaXNzdWVyIjoiZGlkOmtleTp6RG5hZVpLWTQydFdzNzkycko0RmdrQWtRVHlFQTdoamdLRzFtR0N2cTg5MWF6cG5tIiwidHlwZSI6WyJVc2VyQ3JlZGVudGlhbCJdfX0.d7tZxGP8jz42p6nydM_WqbiiRelgcx8cDm-OQkGIYBv-PSJrb-2Vrj1R5Ynv3Y38gH0cdE5kd8rVmtVUU1PjDZ3j0mV3XnJq6b741BjASPl7JYY4_it69w10StxIg9HYafs56tRCD4yKacD00V7v6_jrID6QCJy1vnT_HAUrjTLn0KUIZiZ1mO6DZaSNqxYk4VfOGS-nO2ElwJtS5d9PbtDUW04it8fuXgOWbqgBUmuUFvcf6Ud3tOzGRmCLpWxnP-QqpbUIiQtwatz1PYuqIVf_rwlllu9s6JKxUlbjYguSpz9WnksbbyMAVC80xm-28PY3LnINf3ZgzCx7EfDreg
@OPERATOR_ACCESS_TOKEN = eyJhbGciOiJSUzI1NiIsImtpZCI6IkphZjNTMXkxTzBjNnZXUkZ4Z1FGek5fMjdMSjhzdnotUHNKTkp0dUVjb0EiLCJ0eXAiOiJKV1QifQ.eyJhdWQiOlsiZGF0YS1zZXJ2aWNlIl0sImNsaWVudF9pZCI6ImRpZDprZXk6ekRuYWVuWVh4aThvanlEVG1hN1hCTGFtNTR2ZVJMTXkyZXNzZEp0TFdaZ1pzZnE5SyIsImV4cCI6MTc1MTU3MzEyOSwiaXNzIjoiZGlkOmtleTp6RG5hZW5ZWHhpOG9qeURUbWE3WEJMYW01NHZlUkxNeTJlc3NkSnRMV1pnWnNmcTlLIiwia2lkIjoiSmFmM1MxeTFPMGM2dldSRnhnUUZ6Tl8yN0xKOHN2ei1Qc0pOSnR1RWNvQSIsInN1YiI6IiIsInZlcmlmaWFibGVDcmVkZW50aWFsIjp7IkBjb250ZXh0IjpbImh0dHBzOi8vd3d3LnczLm9yZy8yMDE4L2NyZWRlbnRpYWxzL3YxIiwiaHR0cHM6Ly93d3cudzMub3JnL25zL2NyZWRlbnRpYWxzL3YxIl0sImNyZWRlbnRpYWxTdWJqZWN0Ijp7ImVtYWlsIjoidGVzdEB1c2VyLm9yZyIsImZpcnN0TmFtZSI6IlRlc3QiLCJsYXN0TmFtZSI6IlJlYWRlciIsInJvbGVzIjpbeyJuYW1lcyI6WyJPUEVSQVRPUiJdLCJ0YXJnZXQiOiJkaWQ6a2V5OnpEbmFlWktZNDJ0V3M3OTJySjRGZ2tBa1FUeUVBN2hqZ0tHMW1HQ3ZxODkxYXpwbm0ifV19LCJpZCI6InVybjp1dWlkOjFhNDI1YmJhLTFhMGQtNDRmNy05NjgzLWUxYjY4NjY2OTk3NyIsImlzc3VhbmNlRGF0ZSI6IjIwMjUtMDctMDNUMTg6Mzk6MDZaIiwiaXNzdWVyIjoiZGlkOmtleTp6RG5hZVpLWTQydFdzNzkycko0RmdrQWtRVHlFQTdoamdLRzFtR0N2cTg5MWF6cG5tIiwidHlwZSI6WyJPcGVyYXRvckNyZWRlbnRpYWwiXX19.IMlB-gEvn-W3aUQHbauDAVUrw70K1rjMcBzvRN9o_He411iS4ZVsL2o3TmOcyp9CkQKsL8FKP0wGVCLVeegyIZ-EEZzi61x4bpd5UySdIlFvJuhqMbvqPFdHsVa5GV-17V8lCcQO96qrxXAkYI2T6UPzMjyimr7YreuFEb-QtPrHOThe7QEyJafpA24bFMoy54MekomR8ik0OccQ5fRoBrvhZhwLTvaauxTI-76R1IvYT6ZinMCYgSFAxY8OE96R13qFP2v9JVne6kQ9Nm2PVh6T5PPtcbxobvdA474t0_28zkxPEm8wO16eaR6fkCeOz38_WlTonVcoHy9deGV8ww

### 01. Register Marketplace at Provider and obtain its ID
# Generate an access token: 
# ./get_access_token_oid4vp.sh http://ml-data-service.127.0.0.1.nip.io:8080 $USER_CREDENTIAL user ../wallet-identity
@01_CONSUMER-DID = did:key:zDnaeZKY42tWs792rJ4FgkAkQTyEA7hjgKG1mGCvq891azpnm
@01_CONSUMER-NAME = AirQuality ltd.

POST http://{{ML_TMF_API_HOST}}/tmf-api/party/v4/organization
Accept: */*
Content-Type: application/json
Authorization: Bearer {{USER_ACCESS_TOKEN}}

{
    "name": "{{01_CONSUMER-NAME}}",
    "partyCharacteristic": [
        {
            "name": "did",
            "value": "{{01_CONSUMER-DID}}"
        }
    ]
}

# Take note of Marketplace ID in the response body

## Buy access

### 02. List the offerings
# Generate an access token: 
# ./get_access_token_oid4vp.sh http://ml-data-service.127.0.0.1.nip.io:8080 $USER_CREDENTIAL user ../wallet-identity

GET http://{{ML_TMF_API_HOST}}/tmf-api/productCatalogManagement/v4/productOffering
Authorization: Bearer {{USER_ACCESS_TOKEN}}

#Choose an offering and extract its ID to accept it


### 03. Choose an offer and create an order for it
# Generate an access token: 
# ./get_access_token_oid4vp.sh http://ml-data-service.127.0.0.1.nip.io:8080 $USER_CREDENTIAL user ../wallet-identity
@03_ORDER-ID = Order001
@03_OFFER-ID = urn:ngsi-ld:product-offering:961046db-30e5-4ef3-9a83-3b5398140cae
@03_MARKETPLACE-ID = urn:ngsi-ld:organization:e0ecdeed-b14c-4f88-b189-64a3532944ee

POST http://{{ML_TMF_API_HOST}}/tmf-api/productOrderingManagement/v4/productOrder
Accept: */*
Content-Type: application/json
Authorization: Bearer {{USER_ACCESS_TOKEN}}

{
"productOrderItem": [
    {
        "id": "{{03_ORDER-ID}}",
        "action": "add",
        "productOffering": {
            "id":  "{{03_OFFER-ID}}"
        }
    }
    ],
    "relatedParty": [
        {
            "id": "{{03_MARKETPLACE-ID}}"
        }
    ]
}

# Once the order is created, TMForum will notify the ContractManagement to create an entry in the TrustedIssuersList, allowing Fancy Marketplace to access M&P Operation's services with an Operator Credential


### 04. Create an entity as a Marketplace Operator
# Generate an operator access token:
# ./get_access_token_oid4vp.sh http://ml-data-service.127.0.0.1.nip.io:8080 $OPERATOR_CREDENTIAL operator ../wallet-identity

POST http://{{DATA_SERVICE_HOST}}/ngsi-ld/v1/entities
Accept: */*
Content-Type: application/json
Authorization: Bearer {{OPERATOR_ACCESS_TOKEN}}

{
    "id": "urn:ngsi-ld:AirQualityObserved:aqlm01-2025-07-03T11:00:00",
    "type": "AirQualityObserved",
    "airQualityLevel": {
        "type": "Property",
        "value": "3"
    },
    "temperature": {
        "type": "Property",
        "value": 12.2
    },
    "CO": {
        "type": "Property",
        "value": 500,
        "unitCode": "GP"
    },
    "NO": {
        "type": "Property",
        "value": 45,
        "unitCode": "GQ"
    },
    "dateObserved": {
        "type": "Property",
        "value": "2025-07-03T11:00:00/2025-07-03T12:00:00"
    }
}


### 05. Get the created entity
@05_ENTITY-ID = urn:ngsi-ld:AirQualityObserved:aqlm01-2025-07-03T11:00:00

GET http://{{DATA_SERVICE_HOST}}/ngsi-ld/v1/entities/{{05_ENTITY-ID}}
Accept: */*
Authorization: Bearer {{OPERATOR_ACCESS_TOKEN}}